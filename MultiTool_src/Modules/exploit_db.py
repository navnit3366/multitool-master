import requests, subprocess
from bs4 import BeautifulSoup
from colorama import Fore


class exploit_db_():
    def __init__(self):
        subprocess.call('clear', shell=True)

        print(f"""{Fore.WHITE}
▓█████ ▒██   ██▒ ██▓███   ██▓     ▒█████   ██▓▄▄▄█████▓   ▓█████▄  ▄▄▄▄   
▓█   ▀ ▒▒ █ █ ▒░▓██░  ██▒▓██▒    ▒██▒  ██▒▓██▒▓  ██▒ ▓▒   ▒██▀ ██▌▓█████▄ 
▒███   ░░  █   ░▓██░ ██▓▒▒██░    ▒██░  ██▒▒██▒▒ ▓██░ ▒░   ░██   █▌▒██▒ ▄██
▒▓█  ▄  ░ █ █ ▒ ▒██▄█▓▒ ▒▒██░    ▒██   ██░░██░░ ▓██▓ ░    ░▓█▄   ▌▒██░█▀  
░▒████▒▒██▒ ▒██▒▒██▒ ░  ░░██████▒░ ████▓▒░░██░  ▒██▒ ░    ░▒████▓ ░▓█  ▀█▓
░░ ▒░ ░▒▒ ░ ░▓ ░▒▓▒░ ░  ░░ ▒░▓  ░░ ▒░▒░▒░ ░▓    ▒ ░░       ▒▒▓  ▒ ░▒▓███▀▒
 ░ ░  ░░░   ░▒ ░░▒ ░     ░ ░ ▒  ░  ░ ▒ ▒░  ▒ ░    ░        ░ ▒  ▒ ▒░▒   ░ 
   ░    ░    ░  ░░         ░ ░   ░ ░ ░ ▒   ▒ ░  ░          ░ ░  ░  ░    ░ 
   ░  ░ ░    ░               ░  ░    ░ ░   ░                 ░     ░      
                                                           ░            ░ 

        """)

        self.search = input(f'{Fore.BLUE}[CONSOLE] Search something: ')

    def searcher(self):
        headers = {'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.66 Safari/537.3'}
        q = 0
        L = [3, 10, 30, 50]
        try:
            for i in range(70):
                url = f"https://nvd.nist.gov/vuln/search/results?query={self.search}&results_type=overview&form_type=Basic&search_type=all&startIndex={i}0"
                req = requests.get(url, headers=headers, timeout=10000)
                soup = BeautifulSoup(req.text, 'lxml')
                tbody = soup.find('tbody')
                tr = tbody.find_all('tr')
                q += 1
                for t in tr:
                    desc = t.find('p')
                    date = t.find('span')
                    cve = t.find('a')
                    link = t.find('a', href=True)
                    print(f'{Fore.GREEN}\n----------INFO- {cve.text}----------\n')
                    print(Fore.WHITE + cve.text)
                    print(f'{Fore.WHITE}Date found: {date.text}')
                    print(f'{Fore.WHITE}CVE description: {desc.text}')
                    print(f'{Fore.WHITE}Link: https://nvd.nist.govlink' + link['href'] + '\n')
                if q in L:
                    a = input(f'{Fore.BLUE}\nDo you want to continue searching? ')
                    if a == 'y':
                        pass

                    elif a == 'n':
                        raise StopIteration
                else:
                    pass

        except StopIteration:
            pass